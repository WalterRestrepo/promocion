<!DOCTYPE HTML>
<html>

<head>
	<meta charset="utf-8" />
	<link rel=StyleSheet href="listapromocionescss" type="text/css" />
	<link rel=StyleSheet href="vistadetalladacss" type="text/css" />
	<title>Descuentos YA! - Lista de Promociones</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Latest compiled and minified CSS -->
	<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
	 crossorigin="anonymous"> -->
	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
	 crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
	 crossorigin="anonymous"></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
	 crossorigin="anonymous"></script>
	<style>
		#map {
			  height: 250px; width: 40%;
			}
	</style>
</head>

<body width="90%">
	<p>
	</p>
	<TABLE align="center" bgcolor="white" width="720" height="6">
		<TABLE align="center">
			<TR>
				<TD>
					<h1 class="login-title">¡Descuentos YA! ¡¡Las Mejores Promociones Siempre!! </h1>
				</TD>
			</TR>
		</TABLE>
	</TABLE>
	<section id="s_lista">
		<article>
			<table class="table table-striped" align="center">
				<thead>
					<tr>
						<th>Nombre</th>
						<th>Descripcion</th>
						<th>Precio</th>
						<th>Porcion descuento</th>
						<th>Redimir</th>
					</tr>
				</thead>
				<tbody id="table_promociones">
				</tbody>
			</table>
		</article>
		<aside>
			<p>
				<table align="center">
					<tr>
						<th>Filtros</th>
					</tr>
					<td>
						<fieldset id="f_momento_dia">
						</fieldset>
						<fieldset id="f_restriccion_alimenticia">
						</fieldset>
						<fieldset id="f_tipo_comida">
							<legend style="font-size: 15">Tipo Comida</legend>
							<select style="font-size: 15" id="s_tipo_comida">
							</select>
						</fieldset>
					</td>
				</table>

			</p>
		</aside>
	</section>
	<section id="s_detalle">
		<div id="imagenComida">
		</div>
		<span id="p_NombreComercio"></span>
		<span id="p_NombrePromocion"></span>
		<span id="p_precio"></span>
		<span id="p_porcion_descuento"></span>
		<span id="p_descripcion"></span>
		<div id="map"></div>
		<span id="p_direccion"></span>
		<span id="p_barrio"></span>
		<span id="p_telefono"></span>
		<span id="p_MomentoDia"></span>
		<span id="p_Restriccion"></span>
		<span id="p_TipoComida"></span>
		<div id="botonRedimir2"></div>
		<section id="s_redencion">
		</section>
	</section>
	<footer>
		<h3>Derechos Reservados Descuentos YA!</h3>
	</footer>


</body>
<script>
	function redimePromocion(idPromocion) {
		$("#s_redencion").show();
		$("#s_lista").hide();
		$("#s_redencion").empty();
		var Codigo = makeid();
		var html = "";
		data = { id_promocion: idPromocion, codigo: Codigo };
		$.post("/redencion/save", data, function (response) {
			if (response.insert == 1) {
				html += '<input type="text" value="' + Codigo + '" align="Center" class="login-button" readonly>';
				html += '<input type="text" class="login-lost" value="Recuerda que para hacer efectiva la promocion es necesario mostrar el codigo en el punto de atencion!">';
			} else {
				html += 'Ocurrió un error';
			}
			$("#s_redencion").append(html);
		});
	}
	function makeid() {
		var text = "";
		var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
		for (var i = 0; i < 5; i++)
			text += possible.charAt(Math.floor(Math.random() * possible.length));
		return text;
	}
	function detallePromocion(idPromocion) {
		$("#s_detalle").show();
		$("#s_redencion").hide();
		$("#s_lista").hide();
		$("#table_promociones").empty();
		$.getJSON("/promociones/get/" + idPromocion, function (data) {
			$("#table_promociones").empty();
			var items = [];
			var Lati, Longi;
			$.each(data, function (key, val) {
				Lati = parseFloat(val.latitud);
				Longi = parseFloat(val.longitud);
				var ubicacion = { lat: Lati, lng: Longi };
				var map = new google.maps.Map(document.getElementById('map'), { zoom: 15, center: ubicacion });
				var marker = new google.maps.Marker({ position: ubicacion, map: map });
				$("#p_NombreComercio").html(val.NombreComercio);
				$("#p_NombrePromocion").html(val.NombrePromocion);
				$("#p_precio").html(val.precio);
				$("#p_porcion_descuento").html(val.porcion_descuento);
				$("#p_descripcion").html(val.descripcion);
				$("#p_direccion").html(val.direccion);
				$("#p_barrio").html(val.barrio);
				$("#p_telefono").html(val.telefono);
				$("#p_MomentoDia").html(val.MomentoDia);
				$("#p_Restriccion").html(val.Restriccion);
				$("#p_TipoComida").html(val.TipoComida);
				$("#imagenComida").html('<IMG id="imagenComida" src="http://localhost:8081/pr omo/img/' + val.imagen + '" width="600" height="300">');
				$("#botonRedimir2").html("<button type='button' onclick='redimePromocion(" + val.id_promocion + ")'>Redime</button>");
			});
		});
	}
	$(document).ready(function () {
		$("#s_detalle").hide();
		$("#s_redencion").hide();
		$("#f_momento_dia").hide();
		$("#f_restriccion_alimenticia").hide();
		$("#f_tipo_comida").hide();

		$.get("/promociones/tipocomida/get", function (response) {
			if (response.length > 0){
				debugger;
				var Opciones = "";
				$("#f_tipo_comida").html();
				$("#f_tipo_comida").show();

				$("#s_tipo_comida").html();
				$("#s_tipo_comida").append("<option value='0'>Seleccione</option>");
				for (i = 0; i < response.length; i++) {
					$("#actividades").append("<option value='" + response[i].id_actividad + "'>" + response[i].cliente + ":" + response[i].actividad + "</option>");
				}


	            	for (i = 0; i < response.length; i++) {
					Opciones += "<option value='" + response[i].TipoComida + "'>" + response[i].TipoComida + "</option>";
					}
				$("#f_tipo_comida").append(Opciones);
				$("#f_tipo_comida").append("</select>");
			}
		});

		$.get("/promociones/restriccion/get", function (response) {
			if (response.length > 0){
				$("#f_restriccion_alimenticia").html();
				$("#f_restriccion_alimenticia").show();
				$("#f_restriccion_alimenticia").append("<legend>Restriccion Alimenticia</legend>");
				for (i = 0; i < response.length; i++) {
					if (response[i].Restriccion !== null){
						$("#f_restriccion_alimenticia").append("<input onclick=Restriccion('" + response[i].Restriccion +  "') type='checkbox' name=" + response[i].Restriccion +  "'>" + response[i].Restriccion +  "<br>");
					}
				}
			}
		});

		$.get("/promociones/momento/get", function (response) {
			if (response.length > 0){
				$("#f_momento_dia").html();
				$("#f_momento_dia").show();
				$("#f_momento_dia").append("<legend>Momento del dia</legend>");
				for (i = 0; i < response.length; i++) {
					$("#f_momento_dia").append("<input onclick='MomentoDia('" + response[i].MomentoDia + "')' type='checkbox' name = '" + response[i].MomentoDia + "'>" + response[i].MomentoDia + "<br>");
				}
			}
		});

		$.getJSON("/promociones/get", function (data) {
			$("#table_promociones").empty();
			var items = [];
			$.each(data, function (key, val) {
				var rowContent = "";
				rowContent += "<td>";
				rowContent += val.NombrePromocion;
				rowContent += "</td>";
				rowContent += "<td>";
				rowContent += val.descripcion;
				rowContent += "</td>";
				rowContent += "<td>";
				rowContent += val.precio;
				rowContent += "</td>";
				rowContent += "<td>";
				rowContent += val.porcion_descuento;
				rowContent += "</td>";
				rowContent += "<td><button type='button' onclick='detallePromocion(" + val.id_promocion + ")'>Redime</button></td>";
				items.push("<tr>" + rowContent + "</tr>");
			});
			$("#table_promociones").append(items);
		});
	});
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCASET0ea56OnBa6ECbdBx9XXfuFi86cEs&callback=initMap">































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































</script>
<script>
	function initMap() {
		var ubicacion = { lat: 6.345423, lng: -75.549982 };
		var map = new google.maps.Map(
			document.getElementById('map'), { zoom: 15, center: ubicacion });
		var marker = new google.maps.Marker({ position: ubicacion, map: map });
	}
</script>

</html>